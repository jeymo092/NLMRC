
{% extends "base.html" %}

{% block title %}Edit Client - New Life Mwangaza{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header bg-warning text-dark py-2">
                <h4 class="mb-0"><i class="fas fa-edit"></i> Edit Client: {{ client.firstName }} {{ client.secondName }}</h4>
            </div>
            <div class="card-body">
                <form method="POST" id="editClientForm">
                    <!-- Basic Information -->
                    <div class="mb-3">
                        <h6 class="text-primary border-bottom pb-1 mb-2">Basic Information</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="firstName" class="form-label">First Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control form-control-sm" id="firstName" name="firstName" value="{{ client.firstName }}" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="secondName" class="form-label">Second Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control form-control-sm" id="secondName" name="secondName" value="{{ client.secondName }}" required>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="nickname" class="form-label">Nickname</label>
                                    <input type="text" class="form-control form-control-sm" id="nickname" name="nickname" value="{{ client.nickname or '' }}">
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <label for="dateOfBirth" class="form-label">Date of Birth <span class="text-danger">*</span></label>
                                    <input type="date" class="form-control form-control-sm" id="dateOfBirth" name="dateOfBirth" value="{{ client.dateOfBirth }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <label for="age" class="form-label">Age <span class="text-danger">*</span></label>
                                    <input type="number" class="form-control form-control-sm" id="age" name="age" value="{{ client.age }}" readonly style="background-color: #f8f9fa;">
                                    <small class="text-muted">Auto-calculated</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Admission Information -->
                    <div class="mb-3">
                        <h6 class="text-primary border-bottom pb-1 mb-2">Admission Information</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="admissionType" class="form-label">Admission Type <span class="text-danger">*</span></label>
                                    <select class="form-select form-select-sm" id="admissionType" name="admissionType" required>
                                        <option value="">Select type</option>
                                        <option value="STREET" {{ 'selected' if client.admissionType == 'STREET' }}>Street</option>
                                        <option value="REFERRAL" {{ 'selected' if client.admissionType == 'REFERRAL' }}>Referral</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="intake" class="form-label">Intake Number</label>
                                    <input type="number" class="form-control form-control-sm" id="intake" name="intake" value="{{ client.intake }}">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="status" class="form-label">Status</label>
                                    <select class="form-select form-select-sm" id="status" name="status">
                                        <option value="ACTIVE" {{ 'selected' if client.status == 'ACTIVE' }}>Active</option>
                                        <option value="DISCHARGED" {{ 'selected' if client.status == 'DISCHARGED' }}>Discharged</option>
                                        <option value="EARLY_REINTEGRATION" {{ 'selected' if client.status == 'EARLY_REINTEGRATION' }}>Early Reintegration</option>
                                        <option value="REFERRAL" {{ 'selected' if client.status == 'REFERRAL' }}>Referral</option>
                                        <option value="COMPLETE" {{ 'selected' if client.status == 'COMPLETE' }}>Complete</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="row" id="referralFields" style="display: {{ 'block' if client.admissionType == 'REFERRAL' else 'none' }};">
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <label for="referralInstitution" class="form-label">Referral Institution</label>
                                    <input type="text" class="form-control form-control-sm" id="referralInstitution" name="referralInstitution" value="{{ client.referralInstitution or '' }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-2">
                                    <label for="referralContact" class="form-label">Referral Contact</label>
                                    <input type="text" class="form-control form-control-sm" id="referralContact" name="referralContact" value="{{ client.referralContact or '' }}">
                                </div>
                            </div>
                        </div>

                        <div class="mb-2" id="streetField" style="display: {{ 'block' if client.admissionType == 'STREET' else 'none' }};">
                            <label for="streetName" class="form-label">Street Name</label>
                            <input type="text" class="form-control form-control-sm" id="streetName" name="streetName" value="{{ client.streetName or '' }}">
                        </div>
                    </div>

                    <!-- Education Information -->
                    <div class="mb-3">
                        <h6 class="text-primary border-bottom pb-1 mb-2">Education Information</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="educationLevel" class="form-label">Education Level</label>
                                    <select class="form-select form-select-sm" id="educationLevel" name="educationLevel">
                                        <option value="">Select level</option>
                                        <option value="Primary" {{ 'selected' if client.educationLevel == 'Primary' }}>Primary</option>
                                        <option value="Secondary" {{ 'selected' if client.educationLevel == 'Secondary' }}>Secondary</option>
                                        <option value="Tertiary" {{ 'selected' if client.educationLevel == 'Tertiary' }}>Tertiary</option>
                                        <option value="None" {{ 'selected' if client.educationLevel == 'None' }}>None</option>
                                        <option value="Other" {{ 'selected' if client.educationLevel == 'Other' }}>Other</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="grade" class="form-label">Grade</label>
                                    <input type="text" class="form-control form-control-sm" id="grade" name="grade" value="{{ client.grade or '' }}">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="secondaryForm" class="form-label">Secondary Form</label>
                                    <input type="text" class="form-control form-control-sm" id="secondaryForm" name="secondaryForm" value="{{ client.secondaryForm or '' }}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Parent/Guardian Information -->
                    <div class="mb-3">
                        <h6 class="text-primary border-bottom pb-1 mb-2">Parent/Guardian Information</h6>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="parentGuardianName" class="form-label">Parent/Guardian Name</label>
                                    <input type="text" class="form-control form-control-sm" id="parentGuardianName" name="parentGuardianName" value="{{ client.parentGuardianName or '' }}">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="parentGuardianLocation" class="form-label">Location</label>
                                    <input type="text" class="form-control form-control-sm" id="parentGuardianLocation" name="parentGuardianLocation" value="{{ client.parentGuardianLocation or '' }}">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-2">
                                    <label for="parentGuardianContact" class="form-label">Contact</label>
                                    <input type="text" class="form-control form-control-sm" id="parentGuardianContact" name="parentGuardianContact" value="{{ client.parentGuardianContact or '' }}">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex gap-2 mt-3">
                        <button type="submit" class="btn btn-warning btn-sm">
                            <i class="fas fa-save"></i> Update Client
                        </button>
                        <a href="{{ url_for('view_client', client_id=client.id) }}" class="btn btn-secondary btn-sm">
                            <i class="fas fa-arrow-left"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    border-radius: 10px;
    margin-bottom: 0;
}
.form-control:focus, .form-select:focus {
    border-color: #ffc107;
    box-shadow: 0 0 0 0.15rem rgba(255, 193, 7, 0.25);
}
.text-primary {
    color: #007bff !important;
}
.form-label {
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}
.card-body {
    padding: 1rem;
}
</style>

<script>
// Auto-calculate age from date of birth
document.getElementById('dateOfBirth').addEventListener('change', function() {
    const dob = new Date(this.value);
    const today = new Date();
    let age = today.getFullYear() - dob.getFullYear();
    const monthDiff = today.getMonth() - dob.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < dob.getDate())) {
        age--;
    }
    
    document.getElementById('age').value = age >= 0 ? age : '';
});

// Show/hide fields based on admission type
document.getElementById('admissionType').addEventListener('change', function() {
    const referralFields = document.getElementById('referralFields');
    const streetField = document.getElementById('streetField');
    
    if (this.value === 'REFERRAL') {
        referralFields.style.display = 'block';
        streetField.style.display = 'none';
    } else if (this.value === 'STREET') {
        referralFields.style.display = 'none';
        streetField.style.display = 'block';
    } else {
        referralFields.style.display = 'none';
        streetField.style.display = 'none';
    }
});
</script>
{% endblock %}
